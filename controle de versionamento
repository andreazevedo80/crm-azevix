## üìÖ Roadmap de Desenvolvimento

### ‚úÖ Vers√µes Conclu√≠das
- **1.0** ‚Äì Autentica√ß√£o e estrutura base
- **2.0 a 2.2** ‚Äì CRUD de Leads, associa√ß√£o com vendedor, tipo de conta
## vers√£o 2.03 [A Grande Reestrutura√ß√£o: Contas, Contatos e Integridade de Dados]
Objetivo: Criar a base de dados profissional com as entidades "Conta" e "Contato", garantindo a integridade dos dados desde o in√≠cio com valida√ß√µes e padroniza√ß√µes.

# Requisitos da feature:
- A entidade Conta deve ter Raz√£o Social, Nome Fantasia, CNPJ (criptografado), Tipo e um campo is_active para "soft delete".
- O CNPJ deve ser validado (formato e l√≥gica de c√°lculo) e ser√° o identificador √∫nico para evitar Contas duplicadas.
- A entidade Contato deve ser associada a uma Conta e conter nome, email, telefone, cargo e um campo is_active.
- Os n√∫meros de telefone devem ser padronizados e normalizados no backend antes de serem salvos (ex: usando a biblioteca phonenumbers).
- O fluxo de cria√ß√£o de um novo Lead (Oportunidade) deve estar atrelado √† cria√ß√£o/sele√ß√£o de uma Conta e um Contato.
- A busca por duplicatas no fluxo de cria√ß√£o deve ser inteligente, normalizando os nomes para a compara√ß√£o (ex: "Empresa ABC Ltda" deve ser encontrada ao buscar por "empresa abc").

# O que ser√° modificado:
- backend/models.py: Criar os modelos Conta e Contato com os novos campos. Refatorar Lead para se conectar a Conta.
- backend/contas.py (Novo): Criar o Blueprint e as APIs para gerenciar o CRUD de Contas e Contatos, incluindo a l√≥gica de valida√ß√£o, normaliza√ß√£o e criptografia.
- backend/templates/: Criar as novas telas de cadastro que refletem o novo fluxo.

### vers√£o 2.04 [Visualiza√ß√£o e Gest√£o de Contas e Contatos]
Objetivo: Criar a p√°gina de "Detalhes da Conta", que ser√° o hub central para todas as intera√ß√µes com um cliente, e permitir a gest√£o de m√∫ltiplos contatos.

# Requisitos da feature:
- Na lista de contas, o bot√£o "Detalhes" (atualmente desativado) dever√° funcionar, levando para uma nova p√°gina (/contas/<id>).
- A p√°gina de detalhes deve exibir todas as informa√ß√µes da Conta.
- A p√°gina deve ter uma se√ß√£o para listar todos os Contatos associados √†quela Conta.
- Nesta mesma se√ß√£o, deve haver um formul√°rio ou bot√£o para adicionar novos Contatos a uma Conta j√° existente.
- A p√°gina tamb√©m deve ter uma se√ß√£o para listar todas as Oportunidades (Leads) associadas √†quela Conta.

# O que ser√° modificado:
- backend/contas.py: Criar a nova rota /contas/<id> e a API para buscar os detalhes completos de uma conta, incluindo seus contatos e leads.
- backend/templates/contas/detalhe_conta.html (Novo): Criar a nova tela de visualiza√ß√£o.
- backend/static/js/detalhe_conta.js (Novo): Criar o JavaScript para gerenciar a interatividade da p√°gina de detalhes (como adicionar um novo contato via API sem recarregar a p√°gina).

# Requisitos da feature:
- Deve ser poss√≠vel definir uma Conta como "filial" de outra Conta ("matriz").
- Na p√°gina de "Detalhes da Conta", um administrador deve ver um campo para selecionar a "Conta Matriz".
- Na mesma p√°gina, um administrador deve ver um campo para alterar o "Respons√°vel" (o vendedor) por aquela conta.
- Na p√°gina de "Detalhes da conta", o vendedor ou administrador pode editar todos os campos da conta, contato e leads.
- No bot√£o de a√ß√£o do Leads o vendedor pode editar o Status do Lead, pre√ßo e T√≠tulo da Oportunidade.

# O que ser√° modificado:
- backend/models.py: Adicionar a coluna matriz_id na tabela Conta, que se auto-referencia.
- backend/contas.py: Atualizar a API de edi√ß√£o de contas para permitir a altera√ß√£o do user_id (dono) e do matriz_id.
- backend/templates/contas/detalhe_conta.html: Adicionar os campos de edi√ß√£o para o admin.

### vers√£o 2.05: Hierarquia de Contas e Gest√£o de Vendedores

### üîÑ Em Desenvolvimento

### Plano de A√ß√£o e Requisitos de Software - CRM Azevix (Revis√£o 3.0)
Introdu√ß√£o ao Novo Conceito: "Conta", "Contato" e "Lead"
Para suportar suas novas ideias, vamos adotar uma arquitetura de dados profissional:
*Conta*: A entidade central que representa a Empresa ou √ìrg√£o P√∫blico. √â √∫nica e guarda dados como Raz√£o Social, Nome Fantasia, CNPJ e telefone principal.
*Contato*: Uma Pessoa que trabalha em uma Conta. Uma Conta pode ter m√∫ltiplos Contatos (Diretor, Gerente, Financeiro, etc.), cada um com seu pr√≥prio e-mail, telefone e cargo.
*Lead* (Oportunidade): Representa uma Oportunidade de Neg√≥cio. √â um "neg√≥cio em potencial" que voc√™ tem com uma Conta. Ex: "Venda de Sistema de TI", "Renova√ß√£o de Contrato". Um Lead sempre estar√° ligado a uma Conta e, opcionalmente, a um Contato principal.

Introdu√ß√£o: Conceitos Arquiteturais Chave
Fonte √önica da Verdade: O banco de dados √© a fonte √∫nica da verdade. Nenhuma configura√ß√£o cr√≠tica (status, segmentos, regras) ser√° mantida no c√≥digo ("hardcoded").

Seguran√ßa em Primeiro Lugar: Implementaremos pr√°ticas de seguran√ßa desde o in√≠cio, incluindo controle de acesso baseado em pap√©is (Roles), criptografia de dados sens√≠veis e desativa√ß√£o em vez de exclus√£o (soft delete).

Performance e Escalabilidade: O design da base de dados e das APIs levar√° em conta a performance, utilizando √≠ndices e pagina√ß√£o para garantir que a aplica√ß√£o permane√ßa r√°pida conforme os dados crescem.

Requisitos Cont√≠nuos e Operacionais
Estes s√£o pontos que devem ser considerados ao longo de todo o desenvolvimento.

√çndices de Banco de Dados: Durante a cria√ß√£o de cada tabela no models.py, as colunas que ser√£o frequentemente usadas em buscas (cnpj, email, user_id, conta_id, etc.) devem ser marcadas com index=True ou unique=True para garantir a performance das consultas.

### Pr√≥ximas Fases (Roadmap de Desenvolvimento Detalhado)

Objetivo: Implementar a l√≥gica de Matriz/Filial e permitir que administradores reatribuam a responsabilidade de uma conta.

### Plano de A√ß√£o e Requisitos de Software - CRM Azevix (Revis√£o 4.0)
Introdu√ß√£o e Conceitos Chave
O sistema ser√° constru√≠do sobre uma arquitetura Single-Tenant, ideal para ser implantado em ambientes como a Google Cloud para clientes espec√≠ficos. O primeiro usu√°rio a se registrar em uma nova implanta√ß√£o se tornar√° o Admin daquela inst√¢ncia, que ent√£o gerenciar√° os demais usu√°rios.

Hierarquia de Usu√°rios:

Admin: Superusu√°rio com controle total sobre configura√ß√µes, usu√°rios e dados.

Gerente: L√≠der de equipe que visualiza os dados de seus liderados. Pode gerenciar usu√°rios do tipo "Vendedor".

Vendedor: Usu√°rio padr√£o que gerencia apenas suas pr√≥prias contas e oportunidades.

### Roadmap de Desenvolvimento Detalhado

### vers√£o 2.06 [Seguran√ßa e Hierarquia de Usu√°rios]
Objetivo: Implementar um sistema de permiss√µes robusto com diferentes pap√©is (Roles) e uma estrutura de gest√£o de equipes.

# Requisitos da feature:
- O sistema deve ter uma tabela Role no banco para armazenar os pap√©is ('admin', 'gerente', 'vendedor').
- O modelo User ser√° modificado: o campo de texto role ser√° substitu√≠do por um relacionamento com a tabela Role, e um campo gerente_id (auto-relacionamento) ser√° adicionado para definir a hierarquia de equipes.
- O modelo User ter√° um campo is_active para permitir a desativa√ß√£o (soft delete) em vez da exclus√£o.

# O que ser√° modificado:
- backend/models.py: Criar a nova tabela Role e refatorar o modelo User para incluir a rela√ß√£o com Role, o campo gerente_id e o campo is_active.

### vers√£o 2.07 [Novo Fluxo de Cadastro e Perfil de Usu√°rio]
Objetivo: Substituir o registro p√∫blico por um sistema seguro de auto-inicializa√ß√£o para o primeiro administrador e um fluxo de convites para os demais usu√°rios, al√©m de permitir que todos gerenciem suas pr√≥prias senhas.

# Requisitos da feature:
- O sistema deve permitir o registro p√∫blico na rota /register apenas se n√£o houver nenhum usu√°rio cadastrado no banco de dados.
- O primeiro usu√°rio a se registrar no sistema ser√° automaticamente designado com a role de 'admin'.
- Ap√≥s o primeiro registro, a rota /register ser√° efetivamente desativada para o p√∫blico, redirecionando qualquer acesso futuro para a tela de login.
- Admins e Gerentes ter√£o uma op√ß√£o "Convidar Usu√°rio" em um futuro painel de administra√ß√£o.
- Ao convidar, o sistema enviar√° um e-mail com um link de convite seguro e de uso √∫nico.
- O novo usu√°rio clicar√° no link para definir sua pr√≥pria senha e ativar a conta.
- Todos os usu√°rios ter√£o acesso a uma p√°gina /perfil onde poder√£o alterar a pr√≥pria senha.

# O que ser√° modificado:
- backend/auth.py: Modificar a rota /register para implementar a l√≥gica de "primeiro usu√°rio √© admin" e desativar o acesso p√∫blico ap√≥s o primeiro registro. Adicionar a l√≥gica para o novo fluxo de convite (gera√ß√£o de token e a nova rota para a p√°gina de defini√ß√£o de senha).
- backend/templates/auth/: Criar a nova tela set_password.html para o usu√°rio definir sua senha a partir do convite.
- backend/user.py (Novo): Criar um novo Blueprint para a p√°gina de perfil do usu√°rio.
- backend/templates/user/: Criar a nova tela perfil.html.
- backend/email.py (Novo): Criar um m√≥dulo utilit√°rio para o envio de e-mails de convite.

### vers√£o 3.01 [M√≥dulo de Administra√ß√£o: Gest√£o Centralizada]
Objetivo: Criar o painel de administra√ß√£o para centralizar a gest√£o de usu√°rios e configura√ß√µes, eliminando dados "hardcoded".

# Requisitos da feature:
- Criar uma √°rea /admin acess√≠vel apenas para a role 'admin'.
- Gest√£o de Usu√°rios: O admin poder√° listar, convidar, editar (alterar role e gerente_id) e desativar/ativar usu√°rios.
- Gest√£o de Configura√ß√µes: O admin poder√° gerenciar (CRUD) as listas de Status de Leads, Segmentos de Mercado e Motivos de Perda.
- Gest√£o de Dom√≠nios: O admin poder√° gerenciar uma lista de dom√≠nios de e-mail permitidos para convites (deixando-a em branco para permitir qualquer dom√≠nio).
- Gest√£o de SMTP: O admin poder√° configurar os dados do servidor de e-mail (SMTP) que o sistema usar√° para enviar e-mails.

# O que ser√° modificado:
- backend/models.py: Criar as tabelas ConfigStatusLead, ConfigSegmento, ConfigMotivoPerda, ConfiguracaoEmail, DominiosPermitidos.
- backend/admin.py (Novo): Criar o Blueprint com todas as rotas e l√≥gicas do painel de administra√ß√£o.
- backend/templates/admin/: Criar as v√°rias telas de gest√£o para o painel.

### vers√£o 3.02 [Workflow Inteligente de Status]
Objetivo: Guiar o vendedor no processo de vendas com regras de transi√ß√£o.

# Requisitos da feature:
- No painel de administra√ß√£o, ao editar um Status de Lead, o admin poder√° definir quais s√£o os "pr√≥ximos status permitidos".
- O sistema validar√° essa regra ao tentar alterar o status de uma oportunidade, impedindo transi√ß√µes inv√°lidas.

# O que ser√° modificado:
- backend/models.py: Adicionar um campo na tabela ConfigStatusLead para armazenar as transi√ß√µes permitidas.
- backend/contas.py ou backend/leads.py: A rota de atualiza√ß√£o de oportunidade ir√° validar a transi√ß√£o.
- backend/static/js/: O dropdown de status no frontend s√≥ mostrar√° as op√ß√µes de status permitidas.

# vers√£o 4.01 [Propostas: Estrutura, Custos e Lucratividade]
Objetivo: Implementar o m√≥dulo de propostas, o cora√ß√£o financeiro do CRM.

# Requisitos da feature:
- Ser capaz de criar propostas detalhadas, com m√∫ltiplos produtos/servi√ßos de um cat√°logo.
- Adicionar custos (fixos/percentuais) para calcular a margem de lucro estimada.
- A l√≥gica de custos deve ser sens√≠vel ao tipo_conta (P√∫blica vs. Privada).
- Propostas devem ter status e prazos.

# O que ser√° modificado:
- backend/models.py: Criar as tabelas ProdutoServico, Proposta, ItemProposta, CustoProposta.
- backend/propostas.py (Novo): Blueprint com toda a l√≥gica de neg√≥cio para propostas.
- backend/templates/: Novas interfaces para criar e visualizar propostas.

# vers√£o 4.02 [Automa√ß√£o de Documentos e Comunica√ß√£o]
Objetivo: Automatizar a cria√ß√£o e o envio de propostas.

# Requisitos da feature:
- O sistema deve gerar um documento PDF profissional e personaliz√°vel a partir dos dados de uma proposta.
- Deve ser poss√≠vel enviar a proposta gerada por e-mail diretamente do sistema, usando o e-mail configurado do vendedor.

# O que ser√° modificado:
- backend/propostas.py: Adicionar a rota para gera√ß√£o de PDF e a l√≥gica de envio de e-mail.
- backend/email.py (Novo): M√≥dulo utilit√°rio para envio de e-mails, lendo as configura√ß√µes do banco de dados.

# vers√£o 5.01 [M√≥dulo de Relat√≥rios e Dashboard Inteligente]
Objetivo: Fornecer intelig√™ncia de neg√≥cio, consolidando os dados em relat√≥rios e em um dashboard din√¢mico.

# Requisitos da feature:
- O Dashboard deve exibir um Funil de Vendas visual (quantos R$ est√£o em cada etapa do funil).
- O Dashboard deve mostrar m√©tricas chave: Taxa de Convers√£o, Valor M√©dio das Propostas, etc.
- Deve haver uma p√°gina de Relat√≥rios com filtros (por data, por vendedor) para analisar o desempenho de vendas.
- Todos os relat√≥rios devem ser export√°veis para PDF.

# O que ser√° modificado:
- backend/relatorios.py (Novo): Blueprint para gerar os dados para os relat√≥rios.
- backend/main.py: Rota do dashboard ser√° modificada para consumir os dados da API de relat√≥rios.
- backend/templates/dashboard.html: Substitui√ß√£o do conte√∫do est√°tico por gr√°ficos din√¢micos.
